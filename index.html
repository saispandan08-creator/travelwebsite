<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Namma Kudla — Travel Blog</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#ff6b6b;--muted:#9aa6b2;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial;background:linear-gradient(180deg,#071226 0%,#081428 100%);color:#e6eef6}
    header{display:flex;align-items:center;justify-content:space-between;padding:18px 26px;background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);backdrop-filter: blur(6px)}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:44px;height:44px;border-radius:8px;background:linear-gradient(135deg,var(--accent),#ffd166);display:flex;align-items:center;justify-content:center;font-weight:700;color:#061018}
    nav a{color:var(--muted);text-decoration:none;margin:0 8px;font-size:15px}
    .hero{display:grid;grid-template-columns:1fr 360px;gap:28px;padding:36px;align-items:start}
    .hero-card{background:var(--glass);padding:24px;border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    h1{margin:0 0 8px;font-size:28px}
    p.lead{color:var(--muted);margin:0 0 16px}
    .cta{display:flex;gap:10px}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:#061018;font-weight:600;cursor:pointer}
    .search{display:flex;align-items:center;gap:8px;background:#072033;padding:10px;border-radius:10px}
    input[type="search"]{background:transparent;border:none;color:#dfeefc;outline:none;width:100%;font-size:14px}

    /* posts */
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:16px;margin-top:20px}
    .post{background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent);padding:12px;border-radius:12px}
    .post img{width:100%;height:140px;object-fit:cover;border-radius:8px}
    .meta{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .meta small{color:var(--muted)}
    .tags{display:flex;gap:6px;flex-wrap:wrap;margin-top:8px}
    .tag{background:#092035;padding:6px 8px;border-radius:8px;font-size:12px;color:var(--muted)}

    /* layout */
    main{padding:24px}
    .sidebar{background:var(--glass);padding:18px;border-radius:12px}
    .container{display:grid;grid-template-columns:2fr 340px;gap:22px}

    footer{padding:20px;text-align:center;color:var(--muted)}

    /* modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.6);padding:20px}
    .modal .box{width:760px;max-width:100%;background:var(--card);padding:18px;border-radius:12px}
    label{display:block;margin-top:10px;font-size:13px;color:var(--muted)}
    input,textarea,select{width:100%;padding:10px;border-radius:8px;border:none;background:#071828;color:#dff3ff;margin-top:6px}

    /* responsive */
    @media (max-width:900px){.hero{grid-template-columns:1fr}.container{grid-template-columns:1fr}} 
    /* small helpers */
    .muted{color:var(--muted)}
    .center{display:flex;align-items:center;gap:8px}
    .pill{background:#061822;padding:6px 8px;border-radius:999px;font-size:13px}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);padding:8px 10px;border-radius:8px;color:var(--muted)}
    .stats{display:flex;gap:12px}
    .stat{background:#061822;padding:10px;border-radius:10px;text-align:center}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">NK</div>
    <div>
      <div style="font-weight:700">Namma Kudla</div>
      <div style="font-size:12px;color:var(--muted)">Travel blog & community</div>
    </div>
  </div>
  <nav>
    <a href="#home">Home</a>
    <a href="#blog">Blog</a>
    <a href="#destinations">Destinations</a>
    <a href="#guides">Guides</a>
    <a href="#about">About</a>
    <a href="#contact">Contact</a>
    <button id="openPost">+ New Post</button>
  </nav>
</header>

<section class="hero" id="home">
  <div class="hero-card">
    <h1>Discover Kudla — culture, coast & cuisine</h1>
    <p class="lead">Stories, guides, and local tips from travellers, bloggers and local guides. Explore hidden gems of Kudla (Mangalore).</p>
    <div class="cta">
      <div class="search" style="flex:1">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35" stroke="#6fb8d6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
        <input id="searchInput" type="search" placeholder="Search posts, places...">
      </div>
      <button id="subscribeBtn">Subscribe</button>
    </div>
    <div style="margin-top:14px;display:flex;gap:8px;align-items:center">
      <div class="pill">Featured: Beaches</div>
      <div class="pill">Culture</div>
      <div class="pill">Local Food</div>
    </div>
  </div>
  <aside class="sidebar">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:700">Community Snapshot</div>
        <div class="muted" style="font-size:13px">Active travellers & guides</div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:800;font-size:20px">1.2k</div>
        <div class="muted" style="font-size:12px">Members</div>
      </div>
    </div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
    <div class="stats">
      <div class="stat"><div style="font-weight:700">320</div><div class="muted" style="font-size:12px">Posts</div></div>
      <div class="stat"><div style="font-weight:700">85</div><div class="muted" style="font-size:12px">Guides</div></div>
    </div>
    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
    <div>
      <div style="font-weight:700">Newsletter</div>
      <div class="muted" style="font-size:13px">Get monthly travel tips</div>
      <div style="display:flex;gap:8px;margin-top:8px"><input id="newsEmail" placeholder="you@email.com"><button id="newsBtn" class="btn-ghost">Subscribe</button></div>
    </div>
  </aside>
</section>

<main>
  <div class="container">
    <section>
      <div style="display:flex;justify-content:space-between;align-items:center"><h2 id="blog">Recent Posts</h2><div class="muted">Showing <span id="count">0</span> posts</div></div>
      <div class="grid" id="postsGrid"></div>
    </section>

    <aside>
      <div class="sidebar">
        <h3>Categories</h3>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <button class="tagBtn" data-cat="All">All</button>
          <button class="tagBtn" data-cat="Beaches">Beaches</button>
          <button class="tagBtn" data-cat="Food">Food</button>
          <button class="tagBtn" data-cat="Culture">Culture</button>
        </div>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
        <h3>Top Guides</h3>
        <div id="guidesList"></div>
      </div>
    </aside>
  </div>
</main>

<footer>
  © Namma Kudla — Travel Blog • Built for demo
</footer>

<!-- Modal: New Post -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="box" role="dialog" aria-modal="true" aria-labelledby="newPostTitle">
    <h3 id="newPostTitle">Create New Post</h3>
    <label>Title<input id="postTitle" autocomplete="off"></label>
    <label>Author<input id="postAuthor" autocomplete="off"></label>
    <label>Category<select id="postCategory"><option>Beaches</option><option>Food</option><option>Culture</option><option>Adventure</option></select></label>
    <label>Image URL<input id="postImage" placeholder="https://..."></label>
    <label>Content<textarea id="postContent" rows="6"></textarea></label>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button id="savePost">Publish</button>
      <button id="closeModal" class="btn-ghost">Cancel</button>
    </div>
  </div>
</div>

<!-- Post view modal -->
<div class="modal" id="viewModal" aria-hidden="true"><div class="box" id="viewBox" role="dialog" aria-modal="true"></div></div>

<script>
  // ---------- Utilities ----------
  function $(sel) { return document.querySelector(sel); }
  function $all(sel) { return Array.from(document.querySelectorAll(sel)); }
  const postsKey = 'nk_posts_v1';
  const commentsKey = 'nk_comments_v1';

  // ---------- Sample data ----------
  const samplePosts = [
    {id:1,title:'Sunset at Panambur Beach',author:'Asha',date:'2025-08-12',cat:'Beaches',img:'https://images.unsplash.com/photo-1507525428034-b723cf961d3e',content:'Golden sands and serene sunset. Tips: visit early morning, try local snacks.' ,views:120,comments:3},
    {id:2,title:'Mangalorean Fish Curry: A Guide',author:'Ramesh',date:'2025-07-03',cat:'Food',img:'https://images.unsplash.com/photo-1543353071-087092ec393a',content:'Recipe, best places to try, and etiquette when dining with locals.' ,views:210,comments:8},
    {id:3,title:'Temple Walk: Cultural Insights',author:'Priya',date:'2025-06-20',cat:'Culture',img:'https://images.unsplash.com/photo-1526481280698-9b0f9b1b1a0b',content:'A walking guide to important temples and cultural spots in Kudla.' ,views:95,comments:2}
  ];

  // ---------- Safe localStorage parse ----------
  function safeLoad(key, fallback) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return fallback;
      return JSON.parse(raw);
    } catch (err) {
      console.warn('Failed to parse localStorage for', key, err);
      return fallback;
    }
  }

  function loadPosts() {
    return safeLoad(postsKey, samplePosts.slice());
  }

  function savePosts(list) {
    try {
      localStorage.setItem(postsKey, JSON.stringify(list));
    } catch (err) {
      console.error('Failed to save posts', err);
    }
  }

  // ---------- App state ----------
  let posts = loadPosts();

  // ---------- Render posts ----------
  function renderPosts(list) {
    const grid = $('#postsGrid');
    grid.innerHTML = '';
    list.forEach(p => {
      const el = document.createElement('div');
      el.className = 'post';
      // safe fallback for image and content
      const imgSrc = p.img ? (p.img + (p.img.includes('?') ? '&' : '?') + 'auto=format&fit=crop&w=800&q=60') : '';
      const excerpt = (p.content || '').slice(0, 120);
      el.innerHTML = `
        <img src="${imgSrc}" alt="${escapeHtml(p.title)}">
        <h3 style="margin:8px 0 4px">${escapeHtml(p.title)}</h3>
        <div class="meta"><small>${escapeHtml(p.author)} • ${escapeHtml(p.date)}</small><small>${p.views || 0} views</small></div>
        <p class="muted" style="margin-top:8px">${escapeHtml(excerpt)}${(p.content && p.content.length > 120) ? '...' : ''}</p>
        <div class="tags"><span class="tag">${escapeHtml(p.cat || 'Uncategorized')}</span></div>
        <div style="margin-top:8px;display:flex;justify-content:space-between;align-items:center">
          <button class="btn-view" data-id="${p.id}">Read</button>
          <div class="muted">${p.comments || 0} comments</div>
        </div>
      `;
      grid.appendChild(el);
    });
    $('#count').textContent = list.length;
  }

  // tiny helper to avoid HTML injection in this demo
  function escapeHtml(str) {
    if (typeof str !== 'string') return '';
    return str.replace(/[&<>"']/g, function (m) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];
    });
  }

  renderPosts(posts);

  // ---------- Modal controls ----------
  const modal = $('#modal');
  const openBtn = $('#openPost');
  const closeModal = $('#closeModal');
  const savePost = $('#savePost');
  const viewModal = $('#viewModal');
  const viewBox = $('#viewBox');

  function openNewPostModal() {
    // clear fields
    $('#postTitle').value = '';
    $('#postAuthor').value = '';
    $('#postCategory').value = 'Beaches';
    $('#postImage').value = '';
    $('#postContent').value = '';
    modal.style.display = 'flex';
    modal.setAttribute('aria-hidden', 'false');
    $('#postTitle').focus();
  }

  openBtn.addEventListener('click', openNewPostModal);
  closeModal.addEventListener('click', () => {
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  });

  // Close modals by clicking on overlay (target with class 'modal')
  document.addEventListener('click', (e) => {
    if (e.target && e.target.classList && e.target.classList.contains('modal')) {
      e.target.style.display = 'none';
      e.target.setAttribute('aria-hidden', 'true');
    }
  });

  // keyboard escape to close modals
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      modal.style.display = 'none';
      viewModal.style.display = 'none';
      modal.setAttribute('aria-hidden', 'true');
      viewModal.setAttribute('aria-hidden', 'true');
    }
  });

  // ---------- Save new post ----------
  savePost.addEventListener('click', () => {
    const t = $('#postTitle').value.trim();
    const a = $('#postAuthor').value.trim() || 'Anonymous';
    const c = $('#postCategory').value || 'Uncategorized';
    const img = $('#postImage').value.trim() || 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e';
    const cont = $('#postContent').value.trim();

    if (!t || !cont) {
      alert('Provide title and content');
      return;
    }

    const newP = {
      id: Date.now(),
      title: t,
      author: a,
      date: new Date().toISOString().slice(0, 10),
      cat: c,
      img: img,
      content: cont,
      views: 0,
      comments: 0
    };

    posts.unshift(newP);
    savePosts(posts);
    renderPosts(posts);
    modal.style.display = 'none';
    modal.setAttribute('aria-hidden', 'true');
  });

  // ---------- View post & comments ----------
  document.body.addEventListener('click', (e) => {
    // view post button
    if (e.target && e.target.classList && e.target.classList.contains('btn-view')) {
      const id = Number(e.target.dataset.id);
      const p = posts.find(x => x.id === id);
      if (!p) return;

      // increment views safely
      p.views = (p.views || 0) + 1;
      savePosts(posts);
      renderPosts(posts);

      const imgSrc = p.img ? (p.img + (p.img.includes('?') ? '&' : '?') + 'auto=format&fit=crop&w=1200&q=60') : '';
      viewBox.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <h3>${escapeHtml(p.title)}</h3>
          <div class="muted">${escapeHtml(p.author)} • ${escapeHtml(p.date)}</div>
        </div>
        <img src="${imgSrc}" alt="${escapeHtml(p.title)}" style="width:100%;height:260px;object-fit:cover;margin-top:12px;border-radius:8px">
        <p style="margin-top:12px">${escapeHtml(p.content).replace(/\n/g,'<br>')}</p>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
        <div>
          <h4>Comments</h4>
          <div id="commentsArea"></div>
          <div style="margin-top:8px">
            <input id="cname" placeholder="Name">
            <textarea id="cbody" rows="3" style="margin-top:6px"></textarea>
            <div style="display:flex;justify-content:flex-end;margin-top:6px"><button id="addC">Add Comment</button></div>
          </div>
        </div>
      `;
      viewModal.style.display = 'flex';
      viewModal.setAttribute('aria-hidden', 'false');

      renderComments(p.id);

      // add comment handler (attach after rendering)
      const addCBtn = document.getElementById('addC');
      if (addCBtn) {
        addCBtn.addEventListener('click', () => {
          const name = document.getElementById('cname').value.trim() || 'Guest';
          const body = document.getElementById('cbody').value.trim();
          if (!body) { alert('Enter comment'); return; }

          const map = safeLoad(commentsKey, {});
          map[p.id] = map[p.id] || [];
          map[p.id].push({ name, body, date: new Date().toISOString().slice(0, 10) });
          try {
            localStorage.setItem(commentsKey, JSON.stringify(map));
          } catch (err) {
            console.error('Failed to save comments', err);
          }

          p.comments = (p.comments || 0) + 1;
          savePosts(posts);
          renderPosts(posts);
          renderComments(p.id);

          document.getElementById('cname').value = '';
          document.getElementById('cbody').value = '';
        }, { once: false });
      }
    }

    // guide profile buttons
    if (e.target && e.target.dataset && typeof e.target.dataset.id === 'string' && e.target.dataset.id.startsWith('g')) {
      const id = Number(e.target.dataset.id.slice(1));
      const g = guides.find(x => x.id === id);
      if (!g) return;
      viewBox.innerHTML = `
        <div style="display:flex;gap:12px;align-items:center">
          <img src="${g.avatar}?auto=format&fit=crop&w=400&q=60" style="width:90px;height:90px;border-radius:10px;object-fit:cover">
          <div>
            <h3>${escapeHtml(g.name)}</h3>
            <div class="muted">${escapeHtml(g.exp)} experience</div>
          </div>
        </div>
        <p style="margin-top:12px">${escapeHtml(g.bio)}</p>
        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.03);margin:12px 0">
        <div>
          <h4>Contact</h4>
          <p class="muted">Message ${escapeHtml(g.name)} via email or social links (demo).</p>
        </div>
      `;
      viewModal.style.display = 'flex';
      viewModal.setAttribute('aria-hidden', 'false');
    }
  });

  function renderComments(postId) {
    const map = safeLoad(commentsKey, {});
    const arr = map[postId] || [];
    const area = document.getElementById('commentsArea');
    if (!area) return;
    area.innerHTML = '';
    if (arr.length === 0) {
      area.innerHTML = '<div class="muted">No comments yet. Be the first!</div>';
    } else {
      arr.forEach(c => {
        const d = document.createElement('div');
        d.style.borderTop = '1px solid rgba(255,255,255,0.03)';
        d.style.padding = '8px 0';
       d.innerHTML = `
  <strong>${escapeHtml(c.name)}</strong>
  <span class="muted" style="font-size:12px">• ${escapeHtml(c.date)}</span>
  <div style="margin-top:6px">${escapeHtml(c.body).replace(/\n/g,'<br>')}</div>
`;})}}

  // ---------- Search ----------
  $('#searchInput').addEventListener('input', (e) => {
    const q = e.target.value.toLowerCase().trim();
    if (!q) {
      renderPosts(posts);
      return;
    }
    const res = posts.filter(p => ((p.title || '') + ' ' + (p.content || '') + ' ' + (p.author || '') + ' ' + (p.cat || '')).toLowerCase().includes(q));
    renderPosts(res);
  });

  // ---------- Category filter ----------
  $all('.tagBtn').forEach(b => b.addEventListener('click', (e) => {
    const cat = e.target.dataset.cat;
    if (cat === 'All') renderPosts(posts);
    else renderPosts(posts.filter(p => p.cat === cat));
  }));

  // ---------- Guides list (sample) ----------
  const guides = [
    {id:1,name:'Suresh',bio:'Local cultural guide, speaks Kannada & English',exp:'10 years',avatar:'https://images.unsplash.com/photo-1544005313-94ddf0286df2'},
    {id:2,name:'Maya',bio:'Food & market expert, foodie traveller',exp:'6 years',avatar:'https://images.unsplash.com/photo-1545996124-1b3d5f0b6d1f'}
  ];

  function renderGuides() {
    const el = $('#guidesList');
    el.innerHTML = '';
    guides.forEach(g => {
      const d = document.createElement('div');
      d.style.display = 'flex';
      d.style.gap = '10px';
      d.style.alignItems = 'center';
      d.style.marginTop = '10px';
 d.innerHTML = `
        <img src="${g.avatar}?auto=format&fit=crop&w=100&q=60" style="width:44px;height:44px;border-radius:8px;object-fit:cover">
        <div style="flex:1">
          <strong>${escapeHtml(g.name)}</strong>
          <div class="muted" style="font-size:12px">${escapeHtml(g.bio)}</div>
        </div>
        <div style="margin-left:auto"><button class="btn-ghost" data-id="g${g.id}">Profile</button></div>
      `;
      el.appendChild(d);
    });
  }
  renderGuides();

  // ---------- Subscribe demo ----------
  $('#newsBtn').addEventListener('click', () => {
    const v = $('#newsEmail').value.trim();
    if (!v || !v.includes('@')) { alert('Enter valid email'); return; }
    alert('Thanks! Subscribed: ' + v);
    $('#newsEmail').value = '';
  });
  $('#subscribeBtn').addEventListener('click', () => { alert('Thanks for subscribing!'); });

  // initial render count (ensures sync in UI)
  $('#count').textContent = posts.length;
</script>
</body>
</html>